<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maps - UBC Meetup</title>
    <link rel="stylesheet" href="maps.css">
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="home.html"><button>Home</button></a>
            <a href="maps.html"><button class="active">Maps</button></a>
            <a href="Events.html"><button>Events</button></a>
            <a href="Messages.html"><button>Messages</button></a>
            <a href="Profile.html"><button>Profile</button></a>
        </div>
    </nav>

    <!-- Hero Banner -->
    <div class="hero-banner">
        <div class="hero-text">
            <h1>Choose a spot on the map</h1>
            <p>and plan your <em>own</em> meetup!</p>
        </div>
        <div class="hero-image">
            <img src="Red Panda2.png" alt="Cute Red Panda">
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Restaurant Card (Hidden by default) -->
        <div class="restaurant-card" id="restaurantCard">
            <div class="card-header">
                <img id="restaurantImage" class="card-image" src="" alt="Restaurant">
                <div class="search-bar">
                    <input type="text" id="restaurantNameDisplay" readonly>
                    <span>üîç</span>
                </div>
                <div class="photo-badge">
                    üì∑ See photos
                </div>
            </div>
            <div class="card-content">
                <h2 class="restaurant-name" id="restaurantName">Restaurant Name</h2>
                <div class="rating">
                    <span id="rating">0.0</span>
                    <span class="stars" id="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                    <span id="reviewCount">(0)</span>
                    <span>‚Ä¢</span>
                    <span id="priceLevel">$$</span>
                </div>
                <div class="restaurant-type" id="restaurantType">Restaurant</div>

                <div class="tabs">
                    <div class="tab active">Overview</div>
                    <div class="tab">Menu</div>
                    <div class="tab">Reviews</div>
                    <div class="tab">About</div>
                </div>

                <div class="action-buttons">
                    <div class="action-btn">
                        <div class="action-icon">üß≠</div>
                        <span>Directions</span>
                    </div>
                    <div class="action-btn">
                        <div class="action-icon">üíæ</div>
                        <span>Save</span>
                    </div>
                    <div class="action-btn">
                        <div class="action-icon">üìç</div>
                        <span>Nearby</span>
                    </div>
                    <div class="action-btn">
                        <div class="action-icon">üì±</div>
                        <span>Send to phone</span>
                    </div>
                    <div class="action-btn">
                        <div class="action-icon">‚ÜóÔ∏è</div>
                        <span>Share</span>
                    </div>
                </div>

                <div class="order-buttons">
                    <button class="order-btn order-online">üõí Order online</button>
                    <button class="order-btn waitlist">‚è∞ Join waitlist</button>
                </div>

                <div class="service-options">
                    ‚úì Dine-in ‚Ä¢ ‚úì Takeout
                </div>

                <div class="address">
                    <span>üìç</span>
                    <span id="restaurantAddress">Address</span>
                </div>
            </div>
        </div>

        <!-- Map Section -->
        <div class="map-section">
            <div id="map"></div>
            <div class="selection-box">
                <div class="selection-text">
                    <span id="selectedRestaurant">Selected: None</span>
                </div>
                <button class="create-meetup-btn" id="createMeetupBtn" disabled>Create Meetup</button>
                <div class="success-message" id="successMessage">
                    Event added successfully! ‚úì
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="meetupModal">
        <div class="modal-content">
            <h2>Create Meetup</h2>
            <div class="form-group">
                <label for="meetupDate">Date:</label>
                <input type="date" id="meetupDate" required>
            </div>
            <div class="form-group">
                <label for="meetupTime">Time:</label>
                <input type="time" id="meetupTime" required>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel-btn" id="cancelBtn">Cancel</button>
                <button class="modal-btn confirm-btn" id="confirmBtn">Create</button>
            </div>
        </div>
    </div>

    <script>

        const API_KEY = 'AIzaSyBHplBjzNh6sM6Umtx4bgYJinjHHIaUR28';
        
        // Load Google Maps script
        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places&callback=initMap`;
        script.async = true;
        script.defer = true;
        document.head.appendChild(script);

        let map;
        let service;
        let selectedMarker = null;
        let selectedPlace = null;
        let markers = [];

        // UBC campus center coordinates
        const UBC_CENTER = { lat: 49.2606, lng: -123.2460 };

        function initMap() {
            // Initialize map centered on UBC
            map = new google.maps.Map(document.getElementById('map'), {
                center: UBC_CENTER,
                zoom: 15,
                styles: [
                    {
                        featureType: "poi",
                        elementType: "labels",
                        stylers: [{ visibility: "off" }]
                    }
                ]
            });

            service = new google.maps.places.PlacesService(map);

            // Search for restaurants on UBC campus
            searchRestaurants();
        }

        function searchRestaurants() {
            const request = {
                location: UBC_CENTER,
                radius: 1000, // 1km radius to cover UBC campus
                type: 'restaurant'
            };

            service.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    results.forEach(place => {
                        createMarker(place);
                    });
                }
            });
        }

        function createMarker(place) {
            const marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 8,
                    fillColor: "#000000",
                    fillOpacity: 1,
                    strokeColor: "#ffffff",
                    strokeWeight: 2
                }
            });

            markers.push({ marker, place });

            marker.addListener('click', () => {
                selectRestaurant(marker, place);
            });
        }

        function selectRestaurant(marker, place) {
            // Reset previous selection
            if (selectedMarker) {
                selectedMarker.setIcon({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 8,
                    fillColor: "#000000",
                    fillOpacity: 1,
                    strokeColor: "#ffffff",
                    strokeWeight: 2
                });
            }

            // Set new selection with pink color
            marker.setIcon({
                path: google.maps.SymbolPath.CIRCLE,
                scale: 10,
                fillColor: "#FF93A9",
                fillOpacity: 1,
                strokeColor: "#ffffff",
                strokeWeight: 2
            });

            selectedMarker = marker;
            selectedPlace = place;

            // Update selection text
            document.getElementById('selectedRestaurant').innerHTML = 
                `<span>Selected: ${place.name}</span>`;
            
            // Enable create meetup button
            document.getElementById('createMeetupBtn').disabled = false;

            // Get detailed place information
            service.getDetails({ placeId: place.place_id }, (placeDetails, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    displayRestaurantCard(placeDetails);
                }
            });
        }

        function displayRestaurantCard(place) {
            const card = document.getElementById('restaurantCard');
            card.classList.add('active');

            // Set restaurant image
            const imageUrl = place.photos && place.photos.length > 0 
                ? place.photos[0].getUrl({ maxWidth: 400 })
                : 'https://via.placeholder.com/400x200?text=No+Image';
            document.getElementById('restaurantImage').src = imageUrl;

            // Set restaurant details
            document.getElementById('restaurantNameDisplay').value = place.name;
            document.getElementById('restaurantName').textContent = place.name;
            document.getElementById('rating').textContent = place.rating || 'N/A';
            document.getElementById('reviewCount').textContent = 
                `(${place.user_ratings_total || 0})`;
            
            // Set stars
            const rating = place.rating || 0;
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5 ? 1 : 0;
            const emptyStars = 5 - fullStars - halfStar;
            document.getElementById('stars').textContent = 
                '‚òÖ'.repeat(fullStars) + (halfStar ? '‚òÜ' : '') + '‚òÜ'.repeat(emptyStars);

            // Set price level
            const priceLevel = place.price_level 
                ? '$'.repeat(place.price_level) 
                : '$$';
            document.getElementById('priceLevel').textContent = priceLevel;

            // Set restaurant type
            const types = place.types || [];
            const readableType = types
                .filter(t => t !== 'food' && t !== 'point_of_interest' && t !== 'establishment')
                .map(t => t.replace(/_/g, ' '))
                .join(', ') || 'Restaurant';
            document.getElementById('restaurantType').textContent = 
                readableType.charAt(0).toUpperCase() + readableType.slice(1);

            // Set address
            document.getElementById('restaurantAddress').textContent = 
                place.vicinity || place.formatted_address || 'Address not available';
        }

        // Create Meetup Button
        document.getElementById('createMeetupBtn').addEventListener('click', () => {
            document.getElementById('meetupModal').classList.add('active');
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('meetupDate').min = today;
        });

        // Cancel Button
        document.getElementById('cancelBtn').addEventListener('click', () => {
            document.getElementById('meetupModal').classList.remove('active');
            document.getElementById('meetupDate').value = '';
            document.getElementById('meetupTime').value = '';
        });

        // Confirm Button - Create Event
        document.getElementById('confirmBtn').addEventListener('click', () => {
            const date = document.getElementById('meetupDate').value;
            const time = document.getElementById('meetupTime').value;

            if (!date || !time) {
                alert('Please select both date and time');
                return;
            }

            // Create event object
            const event = {
                restaurant: selectedPlace.name,
                placeId: selectedPlace.place_id,
                address: selectedPlace.vicinity || selectedPlace.formatted_address,
                date: date,
                time: time,
                createdAt: new Date().toISOString()
            };

            // Save to database (localStorage for now - replace with actual database)
            const events = JSON.parse(localStorage.getItem('meetupEvents') || '[]');
            events.push(event);
            localStorage.setItem('meetupEvents', JSON.stringify(events));

            // Close modal
            document.getElementById('meetupModal').classList.remove('active');
            
            // Show success message
            const successMsg = document.getElementById('successMessage');
            successMsg.classList.add('active');
            setTimeout(() => {
                successMsg.classList.remove('active');
            }, 3000);

            // Reset form
            document.getElementById('meetupDate').value = '';
            document.getElementById('meetupTime').value = '';

            console.log('Event created:', event);
        });
    </script>
</body>
</html>